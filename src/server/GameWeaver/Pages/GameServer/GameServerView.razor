@using Application.Constants.Identity

@attribute [Route(AppRouteConstants.GameServer.GameServers.View)]
@attribute [Authorize(PermissionConstants.GameServer.Gameserver.Get)]

@if (!_validIdProvided)
{
    <IconWithMessageDisplay Icon="@Icons.Material.Filled.ErrorOutline" Text="Invalid Gameserver Id provided"/>
}
else
{
    <MudPaper Elevation="12" Class="d-flex flex-wrap gap-4 mb-2 pa-4 justify-center align-center mud-text-align-center">
        <MudButton Variant="Variant.Outlined" Color="Color.Warning" StartIcon="@Icons.Material.Filled.ArrowBack"
                   OnClick="@GoBack">Go Back
        </MudButton>
        @if (_canEditGameServer)
        {
            <MudButton Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Edit"
                       OnClick="@ToggleEditMode">@_editButtonText
            </MudButton>
        }
        @if (_editMode)
        {
            <MudButton Variant="Variant.Outlined" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" 
                       OnClick="@Save">Save Changes
            </MudButton>
        }
        @if (_canDeleteGameServer)
        {
            <MudButton Variant="Variant.Outlined" Color="Color.Error" StartIcon="@Icons.Material.Filled.Delete"
                       OnClick="@DeleteGameServer">Delete
            </MudButton>
        }
    </MudPaper>

    <MudPaper Elevation="8" Class="d-flex flex-wrap ma-4 pa-4 gap-4">
        <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
            <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h5">Server Information</MudText>
        </MudItem>
        <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
            <MudTextField @bind-Value="_gameServer.ServerName" Label="Name" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
            <MudTextField @bind-Value="_gameServer.ServerState" Label="Current state" Variant="Variant.Outlined" MaxLines="2" AutoGrow="true" Disabled="true"/>
        </MudItem>
    </MudPaper>
    
    <MudTabs ApplyEffectsToContainer="true" Centered="true" Rounded="true" ActiveTabClass="mud-border-primary">
        <MudTabPanel Text="General">
            
        </MudTabPanel>
        <MudTabPanel Text="Config">
            <MudTextField T="string" @bind-Value="_searchText" Placeholder="Find Configuration" Adornment="Adornment.Start" Class="py-1" TextChanged="@SearchChanged"
                          AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Variant="Variant.Outlined" Margin="Margin.Dense" Immediate="true" Clearable="true"/>
            <MudDivider Vertical="false"/>
            @foreach (var localResource in _localResourceTreeData)
            {
                <MudPaper Width="98%" Elevation="5" Class="pa-2">
                    <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
                        <MudText Color="Color.Secondary" Align="Align.Center" Typo="Typo.h6">@localResource.Value?.Name</MudText>
                    </MudItem>
                    <MudTreeView Items="@localResource.Children" Hover="true" @ref="ResourceTreeView" FilterFunc="ConfigurationFilter">
                        <ItemTemplate Context="item">
                            <MudTreeViewItem Items="@item.Children" Icon="@item.Icon">
                                <BodyContent>
                                    <div style="display: grid; grid-template-columns: 1fr auto; align-items: center; width: 100%">
                                        <MudText Style="justify-self: start;">@(item.Value?.Name)</MudText>
                                        <div style="justify-self: end;">
                                            <MudTextField T="string" bind-Text="@item.Value?.Value"/>
                                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Medium" Color="Color.Inherit"/>
                                        </div>
                                    </div>
                                </BodyContent>
                            </MudTreeViewItem>
                        </ItemTemplate>
                    </MudTreeView>
                </MudPaper>
            }
        </MudTabPanel>
        <MudTabPanel Text="Advanced">
            
        </MudTabPanel>
        <MudTabPanel Text="Raw">

        </MudTabPanel>
    </MudTabs>
}
