@using Application.Constants.Identity
@using Domain.Enums.GameServer

@attribute [Route(AppRouteConstants.GameServer.Games.View)]
@attribute [Authorize(PermissionConstants.GameServer.Game.Get)]

@if (!_validIdProvided)
{
    <IconWithMessageDisplay Icon="@Icons.Material.Filled.ErrorOutline" Text="Invalid Game Id provided"/>
}
else
{
    <MudPaper Elevation="12" Class="d-flex flex-wrap gap-4 mb-2 pa-4 justify-center align-center mud-text-align-center">
        <MudButton Variant="Variant.Outlined" Color="Color.Warning" StartIcon="@Icons.Material.Filled.ArrowBack"
                   OnClick="@GoBack">Go Back
        </MudButton>
        @if (_canEditGame)
        {
            <MudButton Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Edit"
                       OnClick="@ToggleEditMode">@_editButtonText
            </MudButton>
        }
        @if (_editMode)
        {
            <MudButton Variant="Variant.Outlined" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save" 
                       OnClick="@Save">Save Changes
            </MudButton>
        }
    </MudPaper>
    
    @if (_game.SourceType == GameSource.Steam)
    {
        <MudPaper Elevation="8" Class="d-flex flex-wrap ma-4 pa-4 gap-4">
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
                <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h5">Steam Info</MudText>
            </MudItem>
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
                <MudTextField @bind-Value="_game.SteamName" Label="Steam Name" Variant="Variant.Outlined" Disabled="true"/>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Filled.RemoveRedEye" Size="Size.Small"
                           OnClick="@ViewGameOnSteam">View On Steam
                </MudButton>
            </MudItem>
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
                <MudTextField @bind-Value="_game.SteamGameId" Label="Steam Game Id" Variant="Variant.Outlined" Disabled="true"/>
                <MudTextField @bind-Value="_game.SteamToolId" Label="Steam Tool Id" Variant="Variant.Outlined" Disabled="true"/>
            </MudItem>
        </MudPaper>
    }

    <MudPaper Elevation="8" Class="d-flex flex-wrap ma-4 pa-4 gap-4">
        <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
            <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h5">Game Info</MudText>
        </MudItem>
        <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
            <MudTextField @bind-Value="_game.Id" Label="Id" Variant="Variant.Outlined" Disabled="true"/>
            <MudTextField @bind-Value="_game.FriendlyName" Label="Name" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
        </MudItem>
        <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
            <MudTextField @bind-Value="_game.SourceType" Label="Source" Variant="Variant.Outlined" Disabled="true"/>
            <MudCheckBox @bind-Value="_game.SupportsWindows" Label="Windows Support" Disabled="@(!_editMode)"/>
            <MudCheckBox @bind-Value="_game.SupportsLinux" Label="Linux Support" Disabled="@(!_editMode)"/>
            <MudCheckBox @bind-Value="_game.SupportsMac" Label="Mac Support" Disabled="@(!_editMode)"/>
        </MudItem>
        <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-column gap-4">
            <MudTextField @bind-Value="_game.DescriptionShort" Label="Short Description" Variant="Variant.Outlined" MaxLines="2" AutoGrow="true" Disabled="@(!_editMode)"/>
            <MudExpansionPanel Dense="true" Text="About The Game" IsInitiallyExpanded="false">
                <MudTextField @bind-Value="_game.DescriptionAbout" Label="About The Game" Variant="Variant.Outlined" MaxLines="5" AutoGrow="true" Disabled="@(!_editMode)"/>
            </MudExpansionPanel>
            <MudExpansionPanel Dense="true" Text="Long Description" IsInitiallyExpanded="false">
                <MudTextField @bind-Value="_game.DescriptionLong" Label="Long Description" Variant="Variant.Outlined" MaxLines="10" AutoGrow="true" Disabled="@(!_editMode)"/>
            </MudExpansionPanel>
        </MudItem>
        @if (_canEditGame)
        {
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
                <MudTextField @bind-Value="_game.UrlWebsite" Label="Website URL" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
                <MudTextField @bind-Value="_game.UrlBackground" Label="Background URL" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
            </MudItem>
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
                <MudTextField @bind-Value="_game.UrlLogo" Label="Logo URL" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
                <MudTextField @bind-Value="_game.UrlLogoSmall" Label="Small Logo URL" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
            </MudItem>
        }
        @if (_canEditGame && _game.SourceType == GameSource.Manual)
        {
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
                <MudTextField @bind-Value="_game.ManualFileRecordId" Label="Current Game Version Id" Variant="Variant.Outlined" Disabled="true"/>
                <MudButton Variant="Variant.Outlined" Color="Color.Tertiary" StartIcon="@Icons.Material.Filled.FileOpen"
                           OnClick="@ViewGameVersionFiles">View Game Versions
                </MudButton>
            </MudItem>
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="d-flex flex-wrap gap-4">
                <MudTextField @bind-Value="_game.ManualVersionUrlCheck" Label="Check URL" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
                <MudTextField @bind-Value="_game.ManualVersionUrlDownload" Label="Download URL" Variant="Variant.Outlined" Disabled="@(!_editMode)"/>
            </MudItem>
        }
    </MudPaper>
    
    @if (_canViewGameFiles && _game.SourceType == GameSource.Manual)
    {
        <MudPaper Elevation="8" Class="d-flex ma-4 pa-4 flex-column justify-center align-center mud-text-align-center">
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
                <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h5">Game Versions</MudText>
            </MudItem>
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
                <MudTable Items="@_manualVersionFiles" Hover="true" Dense="true" Striped="true" Class="d-flex flex-wrap">
                    <HeaderContent>
                        <MudTh></MudTh>
                        <MudTh>Name</MudTh>
                        <MudTh>Format</MudTh>
                        <MudTh>Version</MudTh>
                        <MudTh>Hash</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Icon"><MudIcon Color="Color.Secondary" Icon="@Icons.Material.Filled.InsertDriveFile"/></MudTd>
                        <MudTd DataLabel="Name">@context.FriendlyName</MudTd>
                        <MudTd DataLabel="Format">@(context.Format.ToString())</MudTd>
                        <MudTd DataLabel="Version">@context.Version</MudTd>
                        <MudTd DataLabel="Hash">@context.HashSha256</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudItem>
        </MudPaper>
    }
    
    @if (_canViewGameServers)
    {
        <MudPaper Elevation="8" Class="d-flex ma-4 pa-4 flex-column justify-center align-center mud-text-align-center">
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
                <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h5">Gameservers Running This Game</MudText>
            </MudItem>
            <MudItem xs="12" sm="12" md="12" lg="18" xl="24" xxl="36" Class="pa-2">
                <MudTable Items="@_runningGameservers" Hover="true" Dense="true" Striped="true" Class="d-flex flex-wrap">
                    <HeaderContent>
                        <MudTh></MudTh>
                        <MudTh>Name</MudTh>
                        <MudTh>Modded</MudTh>
                        <MudTh>State</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Icon"><MudIcon Color="Color.Secondary" Icon="@Icons.Material.Filled.SportsEsports"/></MudTd>
                        <MudTd DataLabel="Name">@context.ServerName</MudTd>
                        <MudTd DataLabel="Modded">@context.Modded</MudTd>
                        <MudTd DataLabel="ServerState">@(context.ServerState.ToString())</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudItem>
        </MudPaper>
    }
}
